<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Coding Assistants for the Lab — Scripting, Data Analysis &amp; Automation</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        body {
            font-family: var(--font-family-base);
            background: var(--surface-subtle);
            color: var(--text-strong);
            line-height: var(--line-height-body);
            max-width: none;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        /* Layout: sidebar + main */
        .page-layout {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            position: sticky;
            top: 0;
            align-self: flex-start;
            width: 240px;
            min-width: 240px;
            height: 100vh;
            overflow-y: auto;
            background: var(--surface-default);
            border-right: 1px solid var(--border-subtle);
            padding: var(--space-lg) 0;
            z-index: 50;
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-sm);
            padding: 0 var(--space-lg) var(--space-md);
        }
        .sidebar-title {
            font-size: var(--font-size-sm);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            padding: 0;
        }
        .sidebar-toggle {
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            background: var(--surface-muted);
            color: var(--text-muted);
            font-size: var(--font-size-xs);
            padding: 4px var(--space-sm);
            cursor: pointer;
            white-space: nowrap;
        }
        .sidebar-toggle:hover {
            background: var(--surface-default);
            border-color: var(--border-strong);
        }
        .sidebar-links {
            display: block;
        }
        .sidebar-links a {
            display: block;
            padding: 6px var(--space-lg);
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: background 0.15s, color 0.15s, border-color 0.15s;
        }
        .sidebar-links a:hover,
        .sidebar-links a.active {
            color: var(--color-primary);
            background: var(--surface-muted);
            border-left-color: var(--color-primary);
        }
        .examples-link {
            display: block;
            margin: 0 var(--space-md) var(--space-md);
            padding: 8px var(--space-sm);
            border: 1px solid var(--color-primary);
            border-radius: var(--radius-sm);
            background: var(--surface-muted);
            background: color-mix(in srgb, var(--color-primary) 14%, transparent);
            color: var(--color-primary);
            text-decoration: none;
            font-size: var(--font-size-sm);
            font-weight: 700;
            text-align: center;
            line-height: 1.2;
            transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease;
        }
        .examples-link:hover {
            background: var(--surface-default);
            background: color-mix(in srgb, var(--color-primary) 20%, transparent);
            border-color: var(--color-primary-hover);
            color: var(--color-primary-hover);
        }
        .examples-link-short {
            display: none;
        }
        .sidebar .theme-toggle-sidebar {
            display: block;
            margin: var(--space-lg) var(--space-lg) 0;
            background: var(--surface-muted);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            padding: var(--space-xs) var(--space-sm);
            cursor: pointer;
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            text-align: center;
            width: calc(100% - var(--space-lg) * 2);
        }
        .sidebar .theme-toggle-sidebar:hover { background: var(--surface-default); border-color: var(--border-strong); }
        .sidebar.is-collapsed {
            width: 72px;
            min-width: 72px;
        }
        .sidebar.is-collapsed .sidebar-title,
        .sidebar.is-collapsed .sidebar-links,
        .sidebar.is-collapsed .theme-toggle-sidebar {
            display: none;
        }
        .sidebar.is-collapsed .sidebar-header {
            justify-content: center;
            padding: 0 var(--space-sm);
        }
        .sidebar.is-collapsed .sidebar-toggle {
            width: 100%;
            padding: 6px 0;
        }
        .sidebar.is-collapsed .examples-link {
            margin: 0 var(--space-sm) var(--space-sm);
            padding: 6px 4px;
            font-size: var(--font-size-xs);
        }
        .sidebar.is-collapsed .examples-link-label {
            display: none;
        }
        .sidebar.is-collapsed .examples-link-short {
            display: inline;
        }

        .main-content {
            flex: 1;
            width: 100%;
            max-width: 860px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-xl);
        }

        /* Mobile: collapse sidebar to top bar */
        @media (max-width: 860px) {
            .page-layout { flex-direction: column; }
            .sidebar {
                position: sticky;
                top: 0;
                width: 100%;
                min-width: 0;
                height: auto;
                max-height: none;
                border-right: none;
                border-bottom: 1px solid var(--border-subtle);
                padding: var(--space-sm) 0;
                overflow: visible;
                display: block;
            }
            .sidebar-header {
                padding: 0 var(--space-md);
            }
            .sidebar-title { margin: 0; white-space: nowrap; }
            .sidebar-links {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                overflow-x: auto;
                overflow-y: hidden;
                white-space: nowrap;
                padding: var(--space-sm) var(--space-sm) 0;
                gap: 0;
            }
            .sidebar-links a {
                display: inline-block;
                padding: 6px var(--space-sm);
                border-left: none;
                border-bottom: 2px solid transparent;
            }
            .sidebar-links a:hover, .sidebar-links a.active { border-left: none; border-bottom-color: var(--color-primary); }
            .examples-link {
                margin: var(--space-sm) var(--space-sm) 0;
                width: calc(100% - var(--space-sm) * 2);
            }
            .sidebar .theme-toggle-sidebar {
                margin: var(--space-sm) var(--space-sm) 0;
                width: calc(100% - var(--space-sm) * 2);
                white-space: nowrap;
            }
            .sidebar.is-collapsed {
                width: 100%;
                min-width: 0;
            }
            .sidebar.is-collapsed .sidebar-links,
            .sidebar.is-collapsed .theme-toggle-sidebar {
                display: none;
            }
            .sidebar.is-collapsed .examples-link {
                display: block;
                margin: var(--space-sm) var(--space-md) 0;
                width: calc(100% - var(--space-md) * 2);
                font-size: var(--font-size-sm);
                padding: 6px var(--space-sm);
            }
            .sidebar.is-collapsed .examples-link-label {
                display: inline;
            }
            .sidebar.is-collapsed .examples-link-short {
                display: none;
            }
            .sidebar.is-collapsed .sidebar-title {
                display: block;
            }
            .sidebar.is-collapsed .sidebar-header {
                justify-content: space-between;
                padding: 0 var(--space-md);
            }
            .sidebar.is-collapsed .sidebar-toggle {
                width: auto;
                padding: 4px var(--space-sm);
            }
            .main-content {
                width: 100%;
                max-width: 100%;
                padding: var(--space-lg) var(--space-md);
            }
            .agents-header h1 {
                font-size: clamp(1.85rem, 7.5vw, 2.3rem);
            }
            .agents-header p {
                font-size: var(--font-size-base);
            }
            .agents-section {
                padding: var(--space-lg);
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .agents-section h2 {
                font-size: var(--font-size-xl);
            }
            .agents-section h3 {
                font-size: var(--font-size-lg);
            }
        }

        /* Header */
        .agents-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
        }
        .agents-header h1 {
            font-size: var(--font-size-3xl);
            line-height: var(--line-height-heading);
            margin-bottom: var(--space-sm);
        }
        .agents-header p {
            font-size: var(--font-size-lg);
            color: var(--text-muted);
            max-width: 640px;
            margin: 0 auto;
        }

        /* Section cards */
        .agents-section {
            background: var(--surface-default);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            box-shadow: var(--card-shadow);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            scroll-margin-top: var(--space-md);
        }
        .agents-section h2 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--space-md);
            line-height: var(--line-height-heading);
        }
        .agents-section h3 {
            font-size: var(--font-size-xl);
            margin-top: var(--space-lg);
            margin-bottom: var(--space-sm);
        }
        .agents-section h4 {
            font-size: var(--font-size-lg);
            margin-top: var(--space-md);
            margin-bottom: var(--space-xs);
        }
        .agents-section p, .agents-section li {
            font-size: var(--font-size-base);
            color: var(--text-strong);
        }
        .agents-section ul, .agents-section ol {
            padding-left: var(--space-xl);
            margin-bottom: var(--space-md);
        }
        .agents-section li { margin-bottom: var(--space-xs); }
        .agents-section a { color: var(--color-primary); text-decoration: none; }
        .agents-section a:hover { text-decoration: underline; color: var(--color-primary-hover); }

        /* Pros / Cons grid */
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-top: var(--space-md);
        }
        @media (max-width: 640px) { .pros-cons { grid-template-columns: 1fr; } }
        .pros h4 { color: var(--color-success); }
        .cons h4 { color: var(--color-destructive); }

        /* Comparison table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-md);
            font-size: var(--font-size-sm);
        }
        .comparison-table th,
        .comparison-table td {
            text-align: left;
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--border-subtle);
        }
        .comparison-table th { background: var(--surface-muted); font-weight: 600; }
        .comparison-table tr:last-child td { border-bottom: none; }
        .comparison-table .cmp-pro {
            color: var(--color-success);
            font-weight: 500;
        }
        .comparison-table .cmp-con {
            color: var(--color-destructive);
            font-weight: 500;
        }
        .comparison-table .cmp-neutral {
            color: var(--text-muted);
        }

        /* Code blocks */
        code {
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            background: var(--surface-muted);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }
        pre {
            background: var(--neutral-900);
            color: #e2e8f0;
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            overflow-x: auto;
            margin: var(--space-md) 0;
        }
        pre code { background: none; padding: 0; color: inherit; }

        /* Screenshot figures */
        .screenshot {
            margin: var(--space-lg) 0;
            text-align: center;
        }
        .screenshot img {
            max-width: 100%;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-subtle);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .screenshot figcaption {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-top: var(--space-xs);
        }

        /* Tool cards grid */
        .tool-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-top: var(--space-md);
        }
        @media (max-width: 640px) { .tool-cards { grid-template-columns: 1fr; } }
        .tool-card {
            background: var(--surface-subtle);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
        }
        .tool-card h4 { margin-top: 0; }
    </style>
</head>
<body>
    <div class="page-layout">

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="chaptersSidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Chapters</div>
                <button class="sidebar-toggle" id="sidebarToggle" type="button" aria-expanded="true" aria-controls="sidebarLinks">Hide chapters</button>
            </div>
            <a class="examples-link" href="/agents/examples">
                <span class="examples-link-label">Examples Page</span>
                <span class="examples-link-short" aria-hidden="true">Examples</span>
            </a>
            <div class="sidebar-links" id="sidebarLinks">
                <a href="#intro">What Are AI Agents?</a>
                <a href="#agents-vs-chats">Agents vs Standard Chats</a>
                <a href="#agent-platforms">Browser, IDE, and Desktop Agents</a>
                <a href="#use-cases">When to Use What</a>
                <a href="#workflow">Typical Workflow</a>
                <a href="#getting-started">Getting Started</a>
                <a href="#further-reading">Further Reading</a>
            </div>
            <button class="theme-toggle-sidebar" onclick="toggleTheme()" id="themeBtn">Dark mode</button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <header class="agents-header">
                <h1>AI Coding Assistants for the Lab</h1>
                <p>An introduction to AI tools for scripts, data analysis, and measurement automation in a physics lab.</p>
            </header>

            <!-- Introduction -->
            <section id="intro" class="agents-section">
                <h2>What Are AI Coding Assistants?</h2>
                <p>If you write analysis scripts, process instrument data, or automate measurements, AI assistants can save time. The important split is simple: <strong>standard chats</strong> versus <strong>agents</strong>.</p>
                <p>Two useful modes:</p>
                <ul>
                    <li><strong>Standard chat</strong> (ChatGPT, Claude.ai) — great for explanations, debugging advice, and snippets you paste yourself. <b>Runs from browser</b></li>
                    <li><strong>Agent</strong> (Claude Code, OpenAI Codex, Copilot, Cursor) — can read your project, edit files, run commands, and iterate on errors with your permission. <b>Must be installed locally to use the local tools (command line, python etc). Still requires internet connection.</b></li>
                </ul>
                <h3>How They Operate Differently</h3>
                <ul>
                    <li><strong>Standard chat workflow:</strong> you upload or paste a limited set of files. Those files consume context window space, so as projects grow, the model has less room for deep reasoning and long conversation history.</li>
                    <li><strong>Agent workflow:</strong> the agent can start from an overview file such as <code>AGENTS.md</code> (or <code>agent.md</code>), then open only the files needed for the current task instead of loading everything at once.</li>
                    <li><strong>Scalability:</strong> many agents can split work into focused subagents (parallel tasks), which helps with larger codebases and keeps each thread context smaller.</li>
                </ul>
                <p>You do not need to be a software engineer. If you use Python, notebooks, shell scripts, or MATLAB, these tools are already useful.</p>
            </section>

            <!-- Agents vs Standard Chats -->
            <section id="agents-vs-chats" class="agents-section">
                <h2>Agents vs Standard AI Chats</h2>
                <p>Standard chats answer questions. Agents do work inside your project.</p>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Capability</th>
                            <th>Standard Chat (ChatGPT, Claude.ai)</th>
                            <th>Coding Agents (Claude Code, Codex, Copilot)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Access your files</td><td class="cmp-con">Only what you paste or upload</td><td class="cmp-pro">Can read project files directly</td></tr>
                        <tr><td>Initial entry point</td><td class="cmp-con">You must manually choose and upload files</td><td class="cmp-pro">Can start from <code>AGENTS.md</code>/<code>agent.md</code> and follow project instructions</td></tr>
                        <tr><td>Context usage</td><td class="cmp-con">Uploaded files consume context window quickly</td><td class="cmp-pro">Reads files on demand, so context is used more efficiently</td></tr>
                        <tr><td>Edit scripts</td><td class="cmp-con">You copy-paste code manually</td><td class="cmp-pro">Edits files for you</td></tr>
                        <tr><td>Run code</td><td class="cmp-con">No direct execution</td><td class="cmp-pro">Can run scripts and commands</td></tr>
                        <tr><td>Fixing errors</td><td class="cmp-con">You shuttle logs back and forth</td><td class="cmp-pro">Can iterate: run, detect errors, fix, run again</td></tr>
                        <tr><td>Parallel work</td><td class="cmp-con">Single conversation thread</td><td class="cmp-pro">Many agents can split work into subagents and parallel tasks</td></tr>
                        <tr><td>Best use</td><td class="cmp-neutral">Questions, learning, one-off snippets</td><td class="cmp-pro">Real project work across many files</td></tr>
                        <tr><td>Safety model</td><td class="cmp-pro">Read-only by design</td><td class="cmp-neutral">Permission controls and review before applying changes</td></tr>
                    </tbody>
                </table>
                <p style="margin-top: var(--space-md);"><strong>In short:</strong> use chat to think, use agents to execute.</p>
            </section>

            <!-- COMBINED AGENT PLATFORMS -->
            <section id="agent-platforms" class="agents-section">
                <h2>Browser, IDE, and Desktop Agents (Combined)</h2>
                <p>Agents can be used through a browser, your editor, a desktop app, or the terminal. Pick the interface that matches your workflow.</p>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Interface</th>
                            <th>Best for</th>
                            <th>Typical examples</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Terminal agent (CLI)</td><td class="cmp-pro">Local repositories, multi-file scripting tasks, run-fix-retry debugging loops</td><td class="cmp-neutral">Claude Code (CLI)</td></tr>
                        <tr><td>Browser agent (cloud)</td><td class="cmp-pro">Delegating tasks that run remotely and returning later to review</td><td class="cmp-neutral">OpenAI Codex (web)</td></tr>
                        <tr><td>IDE/editor agent</td><td class="cmp-pro">Editing code with AI inside VS Code or similar editors</td><td class="cmp-neutral">Claude Code for VS Code, Codex extension, GitHub Copilot, Cursor</td></tr>
                        <tr><td>Desktop app</td><td class="cmp-neutral">Quick Q&A, file/image analysis, planning before coding</td><td class="cmp-neutral">Claude Desktop</td></tr>
                    </tbody>
                </table>
                <p>All of these follow the same pattern: describe the task, review proposed changes, approve only what you trust.</p>
                <p>
                    <a href="https://docs.anthropic.com/en/docs/claude-code" target="_blank" rel="noopener">Claude Code (CLI)</a> ·
                    <a href="https://chatgpt.com/codex" target="_blank" rel="noopener">OpenAI Codex (Web)</a> ·
                    <a href="https://github.com/features/copilot" target="_blank" rel="noopener">GitHub Copilot</a> ·
                    <a href="https://www.cursor.com" target="_blank" rel="noopener">Cursor</a> ·
                    <a href="https://claude.ai/download" target="_blank" rel="noopener">Claude Desktop</a>
                </p>
            </section>

            <!-- When to Use What -->
            <section id="use-cases" class="agents-section">
                <h2>When to Use What</h2>

                <h3>Use a standard chat (ChatGPT, Claude.ai) when:</h3>
                <ul>
                    <li>You want a quick explanation, concept check, or syntax reminder</li>
                    <li>You are learning a library (NumPy, pandas, SciPy, matplotlib, lmfit)</li>
                    <li>You need a small snippet to paste into a notebook</li>
                    <li>You are planning before touching real project files</li>
                </ul>

                <h3>Use an agent when:</h3>
                <ul>
                    <li>You want AI to work directly on files instead of only giving suggestions</li>
                    <li>The task spans multiple files (analysis code, plotting, config, docs)</li>
                    <li>You want automatic run-fix-retry loops for debugging</li>
                    <li>You want to delegate a well-defined coding task and review results</li>
                </ul>
            </section>

            <!-- Workflow -->
            <section id="workflow" class="agents-section">
                <h2>Typical Agent Workflow</h2>
                <p>Example: "Write a Python script that reads all .dat files in the measurements/ folder, fits each spectrum to a Lorentzian, and saves the fit parameters to a CSV."</p>
                <ol>
                    <li><strong>Describe the task</strong> — Tell the agent what you need in plain language</li>
                    <li><strong>Agent reads your project</strong> — Looks at your existing scripts, data file formats, directory structure</li>
                    <li><strong>Agent writes code</strong> — Creates or modifies scripts, installs packages (<code>pip install lmfit</code>)</li>
                    <li><strong>Agent runs and iterates</strong> — Executes the script, reads errors, fixes issues, re-runs</li>
                    <li><strong>You review</strong> — Check the output, ask for adjustments ("use a Voigt profile instead")</li>
                    <li><strong>Done</strong> — Agent saves your files, optionally creates a version snapshot you can revert to</li>
                </ol>
            </section>

            <!-- Getting Started -->
            <section id="getting-started" class="agents-section">
                <h2>Getting Started</h2>

                <div class="tool-cards">
                    <div class="tool-card">
                        <h4>Standard Chat (Fastest)</h4>
                        <p>Open <a href="https://chatgpt.com" target="_blank" rel="noopener">chatgpt.com</a> or <a href="https://claude.ai" target="_blank" rel="noopener">claude.ai</a> and ask a concrete lab task (for example: "fit this XRD peak and explain each parameter").</p>
                    </div>
                    <div class="tool-card">
                        <h4>Claude Code (CLI)</h4>
                        <pre><code>npm install -g @anthropic-ai/claude-code
cd your-project
claude</code></pre>
                        <p>Node.js 18+ · <a href="https://docs.anthropic.com/en/docs/claude-code" target="_blank" rel="noopener">Docs</a></p>
                    </div>
                    <div class="tool-card">
                        <h4>OpenAI Codex (Browser Agent)</h4>
                        <p>Go to <a href="https://chatgpt.com/codex" target="_blank" rel="noopener">chatgpt.com/codex</a>, connect your GitHub project, and start assigning tasks. Overview: <a href="https://openai.com/codex/" target="_blank" rel="noopener">openai.com/codex</a>.</p>
                    </div>
                    <div class="tool-card">
                        <h4>IDE or Desktop Route</h4>
                        <p>If you prefer graphical tools, use VS Code/Copilot/Cursor or Claude Desktop and start with small edit requests before larger refactors.</p>
                    </div>
                </div>
            </section>

            <!-- Further Reading -->
            <section id="further-reading" class="agents-section">
                <h2>Further Reading</h2>
                <ul>
                    <li><a href="https://docs.anthropic.com/en/docs/claude-code" target="_blank" rel="noopener">Claude Code Documentation</a></li>
                    <li><a href="https://openai.com/codex/" target="_blank" rel="noopener">OpenAI Codex</a></li>
                    <li><a href="https://developers.openai.com/codex" target="_blank" rel="noopener">Codex Developer Documentation</a></li>
                    <li><a href="https://docs.github.com/en/copilot" target="_blank" rel="noopener">GitHub Copilot Documentation</a></li>
                    <li><a href="https://docs.cursor.com" target="_blank" rel="noopener">Cursor Documentation</a></li>
                </ul>
            </section>

        </main>
    </div>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.getElementById('themeBtn');
            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                btn.textContent = 'Dark mode';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                btn.textContent = 'Light mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Restore saved theme
        (function() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeBtn').textContent = 'Light mode';
            }
        })();

        // Toggle chapter navigation (mobile + desktop)
        (function() {
            const sidebar = document.getElementById('chaptersSidebar');
            const toggle = document.getElementById('sidebarToggle');
            const storageKey = 'agents-sidebar-collapsed';
            if (!sidebar || !toggle) return;

            function isMobile() {
                return window.matchMedia('(max-width: 860px)').matches;
            }

            function setSidebarCollapsed(collapsed, persist) {
                sidebar.classList.toggle('is-collapsed', collapsed);
                toggle.setAttribute('aria-expanded', collapsed ? 'false' : 'true');
                toggle.textContent = collapsed ? 'Show chapters' : 'Hide chapters';
                if (persist) {
                    localStorage.setItem(storageKey, collapsed ? '1' : '0');
                }
            }

            const stored = localStorage.getItem(storageKey);
            if (stored === '1' || (stored === null && isMobile())) {
                setSidebarCollapsed(true, false);
            } else {
                setSidebarCollapsed(false, false);
            }

            toggle.addEventListener('click', function() {
                const collapsed = !sidebar.classList.contains('is-collapsed');
                setSidebarCollapsed(collapsed, true);
            });

            window.addEventListener('resize', function() {
                if (localStorage.getItem(storageKey) === null) {
                    setSidebarCollapsed(isMobile(), false);
                }
            });

            const chapterLinks = document.querySelectorAll('.sidebar-links a[href^="#"]');
            chapterLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    if (isMobile()) {
                        setSidebarCollapsed(true, false);
                    }
                });
            });
        })();

        // Highlight active sidebar link on scroll
        (function() {
            const sections = document.querySelectorAll('.agents-section[id]');
            const links = document.querySelectorAll('.sidebar-links a[href^="#"]');
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        links.forEach(function(link) { link.classList.remove('active'); });
                        const active = document.querySelector('.sidebar-links a[href="#' + entry.target.id + '"]');
                        if (active) active.classList.add('active');
                    }
                });
            }, { rootMargin: '-20% 0px -70% 0px' });
            sections.forEach(function(s) { observer.observe(s); });
        })();
    </script>
</body>
</html>
